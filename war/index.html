<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>WordPong</title>
<meta http-equiv="Expires" content="0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="/css/jquery.mobile-1.0a4pre.css" />
<link rel="stylesheet" href="/css/wp.css" type="text/css">
<script type="text/javascript" src="/js/jquery-1.5.min.js"></script>
<script type="text/javascript" src="/js/dump.js"></script>
<script type="text/javascript" src="/js/wp.js"></script>
<script type="text/javascript" src="/js/dateFormat.js"></script>
<script type="text/javascript">
//IE9 FIX
//https://gist.github.com/723870  
$(document).bind("mobileinit", function(){
    $.extend($.mobile, {
        // loadingMessage: 'Ponging...'
        //extend gradeA qualifier to include IE7+
	    gradeA: function(){    	
	    	//IE version check by James Padolsey, modified by jdalton - from http://gist.github.com/527683
			var ie = (function() {
			    var v = 3, div = document.createElement('div'), a = div.all || [];
			    while (div.innerHTML = '<!--[if gt IE '+(++v)+']><br><![endif]-->', a[0]); 
			    return v > 4 ? v : !v;
			}());
	    	//must either support media queries or be IE7+
	    	return $.support.mediaquery || (ie && ie >= 7);
	    }
    });
});
//IE9 FIX
// Soul_Master custom bug fix for ticket #8052
if (jQuery.browser.msie && jQuery.browser.version >= 9) {
 jQuery.support.noCloneEvent = true;
}
</script>
<script type="text/javascript" src="/js/jquery.mobile-1.0a4pre.min.js"></script>
</head>
<body>
<div id="wp-main-page" class="wp-page" data-role="page" data-theme="a" style="width:100%" >
<div class="wp-page-content">
     <div class="wp-loading">
	     <a href="https://wordpong.appspot.com">wp</a>
 	 </div>
</div>
<div class='wp-status'></div>
<div class='wp-date'></div>
<br/>
<br/>
<div class='wp-footer'></div>
<div style="clear:both"></div>
<div class='wp-footer-file'></div>
<form action="/Login.wp" method="post" style='visibility:hidden'>
<input id="wp-init-btn" name="view" value="Load App" type="submit" class="process"/>
</form>
<script type="text/javascript">
// clear password on focus
$('input:password').live("focus", function(e) {
	this.value=''
});
$("input.process").live( "click", function(e) {
    e.preventDefault();
    var action = this.form.action + '?_eventName=' + this.name;
    var params = $(this.form).serialize();
    $.mobile.pageLoading(); //  show the wait icon
	var startTime = new Date();
    var xhr = $.post(action, params, function(data) {
    	if (xhr.getResponseHeader('Stripes-Success') == "OK") {
			var timeDiff = new Date() - startTime;
            $.mobile.pageLoading(true);//close the wait icon
            var content = $('.wp-page-content')
            content.html(data)            
            // Remove unused jquerymobile cached divs
            $('div').remove('[data-role="page"]:not(#wp-main-page)')
            $('div').remove('[data-role="dialog"]')

            var d = $('.wp-date')
            d.html(dateFormat(new Date(),"HH:MM:ss mmm dd")+ " (" + timeDiff + "ms)")
            var p= $('.ui-page-active [data-role="content"]')
            // todo: http://forum.jquery.com/topic/page-level-refresh
            //  add to cache... transisition, back button support
            $('.wp-footer').html(wpFooter);
            $('.wp-footer-file').html(wpFooterFile);
            p.width($(".wp-page").outerWidth() - 30 );
            try {
               p.page()
            } catch (e) {
            }
            $('html, body').animate({scrollTop:0}, 'slow');
        } else {
            alert("Login session expired.");
            window.location.reload(true);
        }
    });
});
$(window).resize(function() {
	var p= $('.ui-page-active [data-role="content"]')
	p.width($(".wp-page").outerWidth() - 30 );
});


$(document).ready(function() {
	// If url contains a query string then redirect to home page without queryString
	var query = location.search.substring(1); 
	if (query!=null && query.length > 0) {
		var data = {queryString: query	};
		var jqxhr = $.post("Login.wp",data, function() {
		        //alert("success");
	            window.location.replace(window.location.protocol+"//"+window.location.host);             
		    })
            .success(function() { 
                //alert("second success"); 
             })
		    .complete(function() { 
			    //alert("complete"); 
			 })        
            .error(function() { 
                //alert("error"); 
             });
		;
	} else {
       $('#wp-init-btn').click();
	}
});
</script>
</div>
</body>
</html>
