<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>WordPong</title>
<link rel="stylesheet" href="/css/jquery.mobile-1.0a4pre.css" />
<link rel="stylesheet" href="/css/wp.css" type="text/css">
<script type="text/javascript" src="/js/jquery-1.5.min.js"></script>
<script type="text/javascript" src="/js/jquery.tmpl.min.js"></script>
<script type="text/javascript" src="/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/js/dump.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript" src="/js/dateFormat.js"></script>
<script type="text/javascript" src="/js/jquery.mobile-1.0a4pre.min.js"></script>
</head>
<body>
<div data-role="page" data-theme="a" style="width:100%" >
<div class="page-content" style="width:100%" >
   <small>&nbsp;&nbsp;<a href="https://wordpong.appspot.com">WordPong</a></small>
</div>
<br><div id='js-status' class='wp-status'></div>
<div class='wp-date'></div>
<div style='height:1000px'></div>
</div>
<form id="refreshForm" action="/Login.wp" method="post">
<input id="initButton" name="view" value="Load App" type="submit" class="process"/>
</form>
<script type="text/javascript">
$("input.process").live( "click", function(e) {
    e.preventDefault();
    var action = this.form.action + '?_eventName=' + this.name;
    var params = $(this.form).serialize();
    $.mobile.pageLoading(); //  show the wait icon
    var xhr = $.post(action, params, function(data) {
        if (xhr.getResponseHeader('Stripes-Success') == "OK") {
            $.mobile.pageLoading(true);//close the wait icon
            var content = $(e).parents('.ui-page-active .page-content:first')
            //alert("content" + content);
            content.html(data)
            var d = $('.wp-date')
            d.html(dateFormat(new Date(),"HH:MM:ss mmm dd"))
            var p= $('.ui-page-active [data-role="content"]')
            // todo: http://forum.jquery.com/topic/page-level-refresh
            //  add to cache... transisition, back button support
            //p.width('97%') // Issue 27: doesnt fill the screen
            p.page();
            //p.page('refresh') // breaks footer online indicator because ajaxSuccess is never fired
        } else {
            alert("Login session expired.");
            window.location.reload(true);
        }
    });
});
$(document).ready(function() {
    $('#initButton').click();
});
</script>
</body>
</html>
